{% extends 'base.html' %}

{% block content %}
    <h2>Register</h2>
    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="text" id="username" name="username" placeholder="Username" required>
        <span id="username-feedback"></span>
        <input type="text" name="name" placeholder="Full Name" required>
        <input type="text" name="profession" placeholder="Profession" required>
        <input type="text" name="location" placeholder="Location" required>
        <textarea name="description" placeholder="Describe yourself (optional)"></textarea>
        <input type="text" name="phone_number" placeholder="Phone Number" required>  <!-- Phone number field -->
        <input type="number" name="age" placeholder="Age" required>  <!-- Age field -->
        <input type="file" name="photo" accept="image/*">  <!-- Photo upload field -->
        <input type="password" name="password" placeholder="Password" required>
        <input type="password" name="password_confirm" placeholder="Confirm Password" required>
        <button type="submit">Register</button>
    </form>
    <a href="{% url 'login' %}">Already have an account? Login</a>

    <script>
        document.getElementById('username').addEventListener('input', function() {
            var username = this.value;
            var feedback = document.getElementById('username-feedback');
            
            if (username.length > 0) {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/check-username/?username=' + username, true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onload = function () {
                    var data = JSON.parse(this.responseText);
                    if (data.is_taken) {
                        feedback.innerHTML = '<span style="color: red;">&#x2718; Username is already taken.</span>';
                    } else {
                        feedback.innerHTML = '<span style="color: green;">&#x2714; Username is available.</span>';
                    }
                };
                xhr.send();
            } else {
                feedback.innerHTML = '';
            }
        });
    </script>
{% endblock %}
